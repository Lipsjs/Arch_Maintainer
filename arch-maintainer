#!/bin/sh
set -e

echo "====================================="
echo "=== Arch Maintainer Tool By Lipsjs ==="
echo "====================================="
echo

# Function to update packages safely
update_system() {
    echo "$(date '+%H:%M:%S') - Updating system packages..."
    
    # Run pacman capture errors to avoid stopping the script
    if ! sudo pacman -Syu --needed --noconfirm; then
        echo "$(date '+%H:%M:%S') - WARNING: Some packages could not be updated due to conflicts."
        echo "Check manually for conflicting packages."
    else
        echo "$(date '+%H:%M:%S') - System update complete!"
    fi
    echo
}

# Function to clean cache
clean_cache() {
    echo "$(date '+%H:%M:%S') - Cleaning package cache..."
    sudo pacman -Sc --noconfirm
    echo "$(date '+%H:%M:%S') - Cache cleaned!"
    echo
}

# Function to check failed services
check_services() {
    echo "$(date '+%H:%M:%S') - Checking failed services..."
    FAILED=$(systemctl --failed --no-legend | wc -l)
    if [ "$FAILED" -gt 0 ]; then
        echo "$(date '+%H:%M:%S') - $FAILED services failed! Check with: systemctl --failed"
    else
        echo "$(date '+%H:%M:%S') - No failed services detected."
    fi
    echo
}


update_system
clean_cache
check_services
#if you're reading this you're goated!<33

echo "$(date '+%H:%M:%S') - Update complete!"
echo "====================================="
echo "=== Maintainer: Lipsjs ==="
echo "====================================="
